{"version":3,"sources":["assets\\script\\manager\\ConfigManager.ts"],"names":[],"mappings":"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","file":"","sourceRoot":"/","sourcesContent":["import Singleton from \"./Singleton\";\r\n\r\n\r\nexport default class ConfigManager extends Singleton {\r\n    private bInit: boolean = false; //是否加载完毕\r\n\r\n    async loadConfig() {\r\n        if (this.bInit) return;\r\n        this.bInit = true;\r\n    }\r\n}\r\n\r\nvar loadJson = async (filepath: string) => {\r\n    return new Promise((resolve, reject) => {\r\n        type kv = { key: string, value: string };\r\n        cc.loader.loadRes(\"config/\" + filepath, cc.JsonAsset, (err, conf: cc.JsonAsset) => {\r\n            if (err) {\r\n                console.error(err)\r\n                reject();\r\n                return;\r\n            }\r\n            resolve(conf.json);\r\n        })\r\n    })\r\n}\r\n// fdm\r\nvar fdm = function shuffle(array: Array<any>, l: number = 0, r: number = 0) {\r\n    if (l > r)[l, r] = [r, l];\r\n    if (l == 0 && r == 0)[l, r] = [0, array.length];\r\n    for (let i = l; i < r; ++i) {\r\n        let k = r\r\n        if (k != i) {\r\n            [array[i], array[k]] = [array[k], array[i]]\r\n        }\r\n    }\r\n}\r\n\r\nvar readConfig = async (filepath: string, c: any) => {\r\n    return new Promise((resolve, reject) => {\r\n        type kv = { key: string, value: string };\r\n        cc.loader.loadRes(\"config/\" + filepath, cc.TextAsset, (err, conf: cc.TextAsset) => {\r\n            if (err) {\r\n                console.error(err)\r\n                reject();\r\n                return;\r\n            }\r\n\r\n            var arr = conf.text.split(\"\\r\\n\");\r\n            var templatestr = arr[1].split(\",\");\r\n            var template: Array<kv> = [];\r\n\r\n            for (var i = 0; i < templatestr.length; ++i) {\r\n                var tmp = templatestr[i].split(\":\");\r\n                if (tmp.length == 2)\r\n                    template.push({ key: tmp[0], value: tmp[1] });\r\n                else\r\n                    template.push({ key: \"key\" + i, value: \"string\" });\r\n            }\r\n\r\n            var items = [];\r\n            for (var i = 2; i < arr.length; ++i) {\r\n                if (arr[i] != \"\") {\r\n                    var datas = arr[i].split(\",\");\r\n                    var item = new c();\r\n                    for (var j = 0; j < datas.length; ++j) {\r\n                        var value: any = datas[j];\r\n                        switch (template[j].value) {\r\n                            case \"number\":\r\n                                value = Number(value);\r\n                                break;\r\n                            case \"string\":\r\n                                value = value.trim();\r\n                                break;\r\n                            case \"boolean\":\r\n                                value = Number(value) == 1;\r\n                                break;\r\n                            case \"table\":\r\n                                value = value.split(\":\");\r\n                                break;\r\n                            case \"inttable\":\r\n                                value = value.split(\":\");\r\n                                for (var v = 0; v < value.length; ++v) {\r\n                                    value[v] = Number(value[v]);\r\n                                }\r\n                                break;\r\n                            case \"lnumber\"://大数据处理\r\n                                value = Number(value);\r\n                                break\r\n                        }\r\n                        item[template[j].key] = value;\r\n                    }\r\n                    items.push(item);\r\n                }\r\n            }\r\n            resolve(items);\r\n        })\r\n    })\r\n}\r\n"]}