{"version":3,"sources":["assets/script/manager/ConfigManager.ts"],"names":[],"mappings":"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","file":"","sourceRoot":"/","sourcesContent":["import Singleton from \"./Singleton\";\n\n\nexport default class ConfigManager extends Singleton {\n    private bInit: boolean = false; //是否加载完毕\n\n    async loadConfig() {\n        if (this.bInit) return;\n        this.bInit = true;\n    }\n}\n\n\nvar loadJson = async (filepath: string) => {\n    return new Promise((resolve, reject) => {\n        type kv = { key: string, value: string };\n        cc.loader.loadRes(\"config/\" + filepath, cc.JsonAsset, (err, conf: cc.JsonAsset) => {\n            if (err) {\n                console.error(err)\n                reject();\n                return;\n            }\n            resolve(conf.json);\n        })\n    })\n}\n\nvar readConfig = async (filepath: string, c: any) => {\n    return new Promise((resolve, reject) => {\n        type kv = { key: string, value: string };\n        cc.loader.loadRes(\"config/\" + filepath, cc.TextAsset, (err, conf: cc.TextAsset) => {\n            if (err) {\n                console.error(err)\n                reject();\n                return;\n            }\n\n            var arr = conf.text.split(\"\\r\\n\");\n            var templatestr = arr[1].split(\",\");\n            var template: Array<kv> = [];\n\n            for (var i = 0; i < templatestr.length; ++i) {\n                var tmp = templatestr[i].split(\":\");\n                if (tmp.length == 2)\n                    template.push({ key: tmp[0], value: tmp[1] });\n                else\n                    template.push({ key: \"key\" + i, value: \"string\" });\n            }\n\n            var items = [];\n            for (var i = 2; i < arr.length; ++i) {\n                if (arr[i] != \"\") {\n                    var datas = arr[i].split(\",\");\n                    var item = new c();\n                    for (var j = 0; j < datas.length; ++j) {\n                        var value: any = datas[j];\n                        switch (template[j].value) {\n                            case \"number\":\n                                value = Number(value);\n                                break;\n                            case \"string\":\n                                value = value.trim();\n                                break;\n                            case \"boolean\":\n                                value = Number(value) == 1;\n                                break;\n                            case \"table\":\n                                value = value.split(\":\");\n                                break;\n                            case \"inttable\":\n                                value = value.split(\":\");\n                                for (var v = 0; v < value.length; ++v) {\n                                    value[v] = Number(value[v]);\n                                }\n                                break;\n                            case \"lnumber\"://大数据处理\n                                value = Number(value);\n                                break\n                        }\n                        item[template[j].key] = value;\n                    }\n                    items.push(item);\n                }\n            }\n            resolve(items);\n        })\n    })\n}\n"]}