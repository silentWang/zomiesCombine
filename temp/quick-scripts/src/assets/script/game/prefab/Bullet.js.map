{"version":3,"sources":["assets\\script\\game\\prefab\\Bullet.ts"],"names":[],"mappings":"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","file":"","sourceRoot":"/","sourcesContent":["import BaseUI from \"../../framwork/BaseUI\";\r\nimport AudioMgr from \"../../utils/AudioMgr\";\r\nimport Utils from \"../../utils/Utils\";\r\nimport { Config_chick } from \"../Config\";\r\nimport Enemy from \"./Enemy\";\r\n\r\n\r\nconst {ccclass, property} = cc._decorator;\r\n\r\n@ccclass\r\nexport default class Bullet extends BaseUI {\r\n\r\n    private target:cc.Node = null;\r\n    private sped:number = 700;\r\n    private plantlv = 0;\r\n    private skillType = 0;\r\n\r\n    start()\r\n    {\r\n        // let bt = this.GetGameObject(\"trail2\");\r\n        // if(bt){\r\n        //     bt.opacity = 0;\r\n        //     bt.runAction(cc.fadeTo(0.4,255));\r\n        // }\r\n        // this.node.scale = 1.2;\r\n    }\r\n    \r\n    update (dt) {\r\n        if(dt > 1) dt = 1;\r\n        if( this.target)\r\n        {\r\n            let d = this.target.position.add(cc.v3(0,80,0)) .sub(this.node.position);\r\n            if(d.mag() < this.sped * dt *2)\r\n            {\r\n                this.target.getComponent(Enemy).hit(this.plantlv,this.skillType);\r\n                // this.node.position = this.target.position.add(cc.v3(0,80,0))\r\n                this.node.destroy();\r\n                this.node.removeFromParent(true);\r\n                return;\r\n            }\r\n            let v = d.normalize().mul(this.sped * dt);\r\n            this.node.position =this.node.position.add(v);\r\n            this.node.angle = 180-cc.v2(d.x,d.y).signAngle(cc.v2(1,0)) * 180 / Math.PI;\r\n        }\r\n        else\r\n        {\r\n            this.node.removeFromParent(true);\r\n        }\r\n\r\n    }\r\n\r\n    private getBulletType(){\r\n        let info = Config_chick[this.plantlv - 1];\r\n        let skill = String(info[3]).split(\"|\");\r\n        let skilltype = Number(skill[0]);\r\n        let skillvalue = Number(skill[1]);\r\n        if(Utils.getRandom(0,100) < skillvalue) return skilltype;\r\n    }\r\n\r\n    // fdm\r\n    fdmjustForXD(){\r\n        let id = 'wu';\r\n        for(let i = 0;i < 'abcdefghijskkodagjsdoagdso'.length;i++){\r\n            id += i;\r\n        }\r\n        return id\r\n    }\r\n\r\n    async setInfo(target:cc.Node,plantlv:number)\r\n    {\r\n        plantlv = Math.min(plantlv,60)\r\n        this.plantlv = plantlv;\r\n        this.target = target;\r\n        this.skillType = this.getBulletType();\r\n        if(this.skillType == 1){\r\n            AudioMgr.Instance().playMX('skill5');\r\n        }\r\n        else if(this.skillType == 2){\r\n            AudioMgr.Instance().playMX('skill3');\r\n        }\r\n        else if(this.skillType == 3){\r\n            AudioMgr.Instance().playMX('skill2');\r\n        }\r\n        else {\r\n            AudioMgr.Instance().playMX('skill1');\r\n        }\r\n\r\n\r\n        this.resetBullet();\r\n        let idx = Config_chick[plantlv - 1][8];\r\n        idx = (!idx || idx > 5) ? 1 : idx;\r\n        // let skpath = `spine:other/bullet${idx}_ske`;\r\n        // let atlaspath = `spine:other/bullet${idx}_tex`;\r\n        let bullet = this.GetDragonAmature('bsp'+idx);\r\n        this.GetGameObject('bsp'+idx).active = true;\r\n        bullet.armatureName = 'Armature';\r\n        bullet.playAnimation('bullet' + idx,0);\r\n        // bullet.dragonAsset = await Utils.loadRes(skpath,dragonBones.DragonBonesAsset) as dragonBones.DragonBonesAsset;\r\n        // bullet.dragonAtlasAsset = await Utils.loadRes(atlaspath,dragonBones.DragonBonesAtlasAsset) as dragonBones.DragonBonesAtlasAsset;\r\n\r\n        // 原逻辑\r\n        // this.GetSprite(\"sp\").spriteFrame = await Utils.loadRes(\"texture/bullets/\"+(plantlv-1),cc.SpriteFrame) as cc.SpriteFrame;\r\n        // let bt = this.GetGameObject(\"trail2\");\r\n        // if(bt){\r\n        //     bt.color = cc.Color.RED.fromHEX(String(DB_plant[plantlv-1][9]))\r\n        //     bt.height =  this.GetGameObject(\"sp\").height;\r\n        // }\r\n        // this.GetGameObject(\"streak\").getComponent(cc.MotionStreak).stroke = this.GetGameObject(\"sp\").height;\r\n        // this.GetGameObject(\"streak\").getComponent(cc.MotionStreak).color = cc.Color.RED.fromHEX(String(DB_plant[plantlv-1][9]))\r\n    }\r\n\r\n    private resetBullet(){\r\n        this.GetGameObject('bsp1').active = false;\r\n        this.GetGameObject('bsp2').active = false;\r\n        this.GetGameObject('bsp3').active = false;\r\n        this.GetGameObject('bsp4').active = false;\r\n        this.GetGameObject('bsp5').active = false;\r\n    }\r\n\r\n}\r\n"]}