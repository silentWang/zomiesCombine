{"version":3,"sources":["assets\\script\\game\\prefab\\AdLayer.ts"],"names":[],"mappings":"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","file":"","sourceRoot":"/","sourcesContent":["import BaseUI from \"../../framwork/BaseUI\";\r\nimport MsgHints from \"../../framwork/MsgHints\";\r\nimport AdCenter from \"../../manager/AdCenter\";\r\nimport Data from \"../../manager/Data\";\r\nimport AudioMgr from \"../../utils/AudioMgr\";\r\nimport Utils from \"../../utils/Utils\";\r\n\r\nconst { ccclass, property } = cc._decorator;\r\n\r\n\r\nenum EADLAYER {\r\n    DOUBLE_ATT,\r\n    DOUBLE_INCOME,\r\n    AUTO_COM,\r\n    DROP_PLANT\r\n}\r\n\r\nconst AUTO_COM_TIME = 2;\r\nconst DOUBLE_INCOME_TIME = 10;\r\nconst DROP_PLANT_TIME = 10;\r\nconst DOUBLE_ATT_TIME = 1;\r\n\r\nexport const MAX_AUTO_COM_TIME = 4;\r\nexport const MAX_DOUBLE_INCOME_TIME = 20;\r\nexport const MAX_DROP_PLANT_TIME = 20;\r\nexport const MAX_DOUBLE_ATT_TIME = 20;\r\n\r\n@ccclass\r\nexport default class AdLayer extends BaseUI {\r\n\r\n    private type: EADLAYER;\r\n    start()\r\n    {\r\n        AdCenter.Instance().showGridAd();\r\n    }\r\n\r\n    onDestroy()\r\n    {\r\n        AdCenter.Instance().hideGridAd();\r\n        super.onDestroy();\r\n    }\r\n\r\n    update(dt)\r\n    {\r\n        if(dt > 1) dt = 1;\r\n        let {end_time,max} = this.getEndAndMaxTime();\r\n        if(end_time > Utils.getServerTime())\r\n        {\r\n            let nLeft = end_time - Utils.getServerTime();\r\n            // this.SetProgressBar(\"New ProgressBar\",(nLeft/1000/60)/max);\r\n            this.SetText(\"lbl_time\",Utils.getTimeStrByS(nLeft/1000));\r\n        }\r\n        else\r\n        {\r\n            // this.SetProgressBar(\"New ProgressBar\",0);\r\n            this.SetText(\"lbl_time\",\"\");\r\n        }\r\n    }\r\n\r\n    private getEndAndMaxTime(){\r\n        let end_time = 0;\r\n        let max = 0;\r\n        if (this.type == EADLAYER.AUTO_COM) {\r\n            end_time = Data.user.auto_com_time;\r\n            max = MAX_AUTO_COM_TIME;\r\n        }\r\n        else if (this.type == EADLAYER.DOUBLE_ATT) {\r\n            end_time = Data.user.double_att_time;\r\n            max = MAX_DOUBLE_ATT_TIME;\r\n        }\r\n        else if (this.type == EADLAYER.DOUBLE_INCOME) {\r\n            end_time = Data.user.double_income_time;\r\n            max = MAX_DOUBLE_INCOME_TIME;\r\n        }\r\n        else if(this.type == EADLAYER.DROP_PLANT)\r\n        {\r\n            end_time = Data.user.drop_plant_time;\r\n            max = MAX_DROP_PLANT_TIME;\r\n        }\r\n        return {end_time,max}\r\n    }\r\n\r\n    setType(e: EADLAYER) {\r\n        this.type = e;\r\n        this.GetGameObject(\"icon_fast\").active = e == EADLAYER.DROP_PLANT;\r\n        this.GetGameObject(\"icon_auto_merge\").active = e == EADLAYER.AUTO_COM;\r\n        this.GetGameObject(\"icon_income\").active = e == EADLAYER.DOUBLE_INCOME;\r\n        this.GetGameObject(\"icon_angre\").active = e == EADLAYER.DOUBLE_ATT;\r\n\r\n        if (this.type == EADLAYER.AUTO_COM) {\r\n            this.SetText(\"lbl_effect\", \"+\" + AUTO_COM_TIME + \"分钟\");\r\n        }\r\n        else if (this.type == EADLAYER.DOUBLE_ATT) {\r\n            this.SetText(\"lbl_effect\", \"+\" + DOUBLE_ATT_TIME + \"分钟\");\r\n        }\r\n        else if (this.type == EADLAYER.DOUBLE_INCOME) {\r\n            this.SetText(\"lbl_effect\", \"+\" + DOUBLE_INCOME_TIME + \"分钟\");\r\n        }\r\n        else if(this.type == EADLAYER.DROP_PLANT)\r\n        {\r\n            this.SetText(\"lbl_effect\", \"+\" + DROP_PLANT_TIME + \"分钟\");\r\n        }\r\n        let {end_time,max} = this.getEndAndMaxTime();\r\n        let isRunning = end_time > Utils.getServerTime();\r\n        this.GetGameObject('btn_ad').active = !isRunning;\r\n        this.GetGameObject('btn_normal').active = !isRunning;\r\n    }\r\n\r\n    private addvalue(double:number = 1)\r\n    {\r\n        let isUse = false;\r\n        if (this.type == EADLAYER.AUTO_COM) {\r\n            if (Data.user.auto_com_time - Utils.getServerTime() > (MAX_AUTO_COM_TIME - AUTO_COM_TIME) * 60 * 1000) {\r\n                MsgHints.show(\"最大累积时间\" + MAX_AUTO_COM_TIME + \"分钟\");\r\n                return;\r\n            }\r\n            if (Data.user.auto_com_time < Utils.getServerTime())\r\n                Data.user.auto_com_time = Utils.getServerTime();\r\n            Data.user.auto_com_time += AUTO_COM_TIME * 60 * 1000 * double;\r\n            isUse = true;\r\n        }\r\n        else if (this.type == EADLAYER.DOUBLE_ATT) {\r\n            if (Data.user.double_att_time - Utils.getServerTime() > (MAX_DOUBLE_ATT_TIME - DOUBLE_ATT_TIME) * 60 * 1000) {\r\n                MsgHints.show(\"最大累积时间\" + MAX_DOUBLE_ATT_TIME + \"分钟\");\r\n                return;\r\n            }\r\n            if (Data.user.double_att_time < Utils.getServerTime())\r\n                Data.user.double_att_time = Utils.getServerTime();\r\n            Data.user.double_att_time += DOUBLE_ATT_TIME * 60 * 1000 * double;\r\n            isUse = true;\r\n        }\r\n        else if (this.type == EADLAYER.DOUBLE_INCOME) {\r\n            if (Data.user.double_income_time - Utils.getServerTime() > (MAX_DOUBLE_INCOME_TIME - DOUBLE_INCOME_TIME) * 60 * 1000) {\r\n                MsgHints.show(\"最大累积时间\" + MAX_DOUBLE_INCOME_TIME + \"分钟\");\r\n                return;\r\n            }\r\n            if (Data.user.double_income_time < Utils.getServerTime())\r\n                Data.user.double_income_time = Utils.getServerTime();\r\n            Data.user.double_income_time += DOUBLE_INCOME_TIME * 60 * 1000 * double;\r\n            isUse = true;\r\n        }\r\n        else if (this.type == EADLAYER.DROP_PLANT) {\r\n            if (Data.user.drop_plant_time - Utils.getServerTime() > (MAX_DROP_PLANT_TIME - DROP_PLANT_TIME) * 60 * 1000) {\r\n                MsgHints.show(\"最大累积时间\" + MAX_DROP_PLANT_TIME + \"分钟\");\r\n                return;\r\n            }\r\n            if (Data.user.drop_plant_time < Utils.getServerTime())\r\n                Data.user.drop_plant_time = Utils.getServerTime();\r\n            Data.user.drop_plant_time += DROP_PLANT_TIME * 60 * 1000 * double;\r\n            isUse = true;\r\n        }\r\n        Data.save();\r\n        if(isUse) {\r\n            this.closeUI();\r\n            MsgHints.show('使用成功');\r\n        }\r\n    }\r\n\r\n    onBtnClicked(event, customEventData) {\r\n        var btnName = event.target.name;\r\n        AudioMgr.Instance().playSFX(\"click\");\r\n        switch (btnName) {\r\n            case \"btn_close\":\r\n                this.closeUI();\r\n                break;\r\n            case \"btn_ad\":\r\n                AdCenter.Instance().play((b)=>{\r\n                    if(b) this.addvalue(2);\r\n                });\r\n                break;\r\n            case \"btn_normal\":\r\n                this.addvalue(1);\r\n                this.GetGameObject('btn_normal').active = false;\r\n                break;\r\n        }\r\n    }\r\n}\r\n\r\n\r\n\r\nexport { EADLAYER }\r\n"]}