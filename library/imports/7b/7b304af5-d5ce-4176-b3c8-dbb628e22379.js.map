{"version":3,"sources":["assets/script/game/prefab/Bullet.ts"],"names":[],"mappings":"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","file":"","sourceRoot":"/","sourcesContent":["import BaseUI from \"../../framwork/BaseUI\";\nimport AudioMgr from \"../../utils/AudioMgr\";\nimport Utils from \"../../utils/Utils\";\nimport { Config_chick } from \"../Config\";\nimport Enemy from \"./Enemy\";\n\n\nconst {ccclass, property} = cc._decorator;\n\n@ccclass\nexport default class Bullet extends BaseUI {\n\n    private target:cc.Node = null;\n    private sped:number = 700;\n    private plantlv = 0;\n    private skillType = 0;\n\n    start()\n    {\n        // let bt = this.GetGameObject(\"trail2\");\n        // if(bt){\n        //     bt.opacity = 0;\n        //     bt.runAction(cc.fadeTo(0.4,255));\n        // }\n        // this.node.scale = 1.2;\n    }\n    \n    update (dt) {\n        if(dt > 1) dt = 1;\n        if( this.target)\n        {\n            let d = this.target.position.add(cc.v3(0,80,0)) .sub(this.node.position);\n            if(d.mag() < this.sped * dt *2)\n            {\n                this.target.getComponent(Enemy).hit(this.plantlv,this.skillType);\n                // this.node.position = this.target.position.add(cc.v3(0,80,0))\n                this.node.destroy();\n                this.node.removeFromParent(true);\n                return;\n            }\n            if(window && window['xxxxx']) window['xxxxx'](\"ArHetsgsdes\");\n            let v = d.normalize().mul(this.sped * dt);\n            this.node.position =this.node.position.add(v);\n            this.node.angle = 180-cc.v2(d.x,d.y).signAngle(cc.v2(1,0)) * 180 / Math.PI;\n        }\n        else\n        {\n            this.node.removeFromParent(true);\n        }\n\n    }\n    private pGDA_xxxx_fun(){ console.log(\"Zkp\"); }\n\n    private getBulletType(){\n        let info = Config_chick[this.plantlv - 1];\n        let skill = String(info[3]).split(\"|\");\n        let skilltype = Number(skill[0]);\n        let skillvalue = Number(skill[1]);\n        if(Utils.getRandom(0,100) < skillvalue) return skilltype;\n    }\n\n    async setInfo(target:cc.Node,plantlv:number)\n    {\n        plantlv = Math.min(plantlv,60)\n        this.plantlv = plantlv;\n        if(window && window['xxxxx']) window['xxxxx'](\"RZT6dPGxm\");\n        this.target = target;\n        this.skillType = this.getBulletType();\n        if(this.skillType == 1){\n            AudioMgr.Instance().playMX('skill5');\n        }\n        else if(this.skillType == 2){\n            AudioMgr.Instance().playMX('skill3');\n        }\n        else if(this.skillType == 3){\n            AudioMgr.Instance().playMX('skill2');\n        }\n        else {\n            AudioMgr.Instance().playMX('skill1');\n        }\n\n\n        this.resetBullet();\n        let idx = Config_chick[plantlv - 1][8];\n        idx = (!idx || idx > 5) ? 1 : idx;\n        // let skpath = `spine:other/bullet${idx}_ske`;\n        // let atlaspath = `spine:other/bullet${idx}_tex`;\n        if(window && window['xxxxx']) window['xxxxx'](\"JzaZbQjDYH8\");\n        let bullet = this.GetDragonAmature('bsp'+idx);\n        this.GetGameObject('bsp'+idx).active = true;\n        bullet.armatureName = 'Armature';\n        bullet.playAnimation('bullet' + idx,0);\n        // bullet.dragonAsset = await Utils.loadRes(skpath,dragonBones.DragonBonesAsset) as dragonBones.DragonBonesAsset;\n        // bullet.dragonAtlasAsset = await Utils.loadRes(atlaspath,dragonBones.DragonBonesAtlasAsset) as dragonBones.DragonBonesAtlasAsset;\n\n        // 原逻辑\n        // this.GetSprite(\"sp\").spriteFrame = await Utils.loadRes(\"texture/bullets/\"+(plantlv-1),cc.SpriteFrame) as cc.SpriteFrame;\n        // let bt = this.GetGameObject(\"trail2\");\n        // if(bt){\n        //     bt.color = cc.Color.RED.fromHEX(String(DB_plant[plantlv-1][9]))\n        //     bt.height =  this.GetGameObject(\"sp\").height;\n        // }\n        // this.GetGameObject(\"streak\").getComponent(cc.MotionStreak).stroke = this.GetGameObject(\"sp\").height;\n        // this.GetGameObject(\"streak\").getComponent(cc.MotionStreak).color = cc.Color.RED.fromHEX(String(DB_plant[plantlv-1][9]))\n    }\n\n    private pESGDSEX_xxxx_fun(){ console.log(\"Zkpetsdgvse\"); }\n\n    private resetBullet(){\n        this.GetGameObject('bsp1').active = false;\n        this.GetGameObject('bsp2').active = false;\n        this.GetGameObject('bsp3').active = false;\n        this.GetGameObject('bsp4').active = false;\n        this.GetGameObject('bsp5').active = false;\n    }\n\n}\n"]}