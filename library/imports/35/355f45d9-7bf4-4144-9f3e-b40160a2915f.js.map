{"version":3,"sources":["assets/script/game/ChickItem.ts"],"names":[],"mappings":"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","file":"","sourceRoot":"/","sourcesContent":["import BaseUI from \"../framwork/BaseUI\";\nimport ChickData from \"../manager/ChickData\";\nimport AudioMgr from \"../utils/AudioMgr\";\nimport Utils from \"../utils/Utils\";\nimport { Config_chick } from \"./Config\";\nimport HallScene from \"./HallScene\";\nimport Bullet from \"./prefab/Bullet\";\nimport { PlantInfo } from \"./UserModel\";\n\n\nconst { ccclass, executeInEditMode, property } = cc._decorator;\n\n@ccclass\nexport default class ChickItem extends BaseUI {\n    @property(cc.Prefab)\n    bullet_pre:cc.Prefab = null;\n    public index: number = -1;\n    public linkItem: ChickItem = null;\n    public datacopy: PlantInfo = null;\n    public bDrag: boolean = false;\n    public droptype:number = 0;\n    private droptype0endtime = 0;\n    private curplayani = \"\";\n\n    start(){\n        let chick = this.GetDragonAmature('chick');\n        chick.addEventListener(dragonBones.EventObject.COMPLETE,this.animComplete,this);\n    }\n\n    setItemData(d: PlantInfo,droptype:number = -1) {// 3普通掉落 4小精灵掉落\n        if(droptype != -1) this.droptype = droptype;\n        if(this.droptype != 0 &&  this.droptype0endtime < Utils.getServerTime())\n        {\n            this.droptype0endtime = Utils.getServerTime() + 10000;\n        }\n        //减少重绘制\n        if (this.datacopy && d) {\n            if (this.datacopy.index == d.index &&\n                this.datacopy.lv == d.lv &&\n                this.datacopy.open == d.open) {\n                return;\n            }\n        }\n\n        this.datacopy = d ? JSON.parse(JSON.stringify(d)) : null;\n        if (this.datacopy) this.datacopy.index = this.index;\n        this.updateItem();\n    }\n\n    async updateItem() {\n        let isNull = this.datacopy == null;\n        this.GetGameObject(\"level_1\").active = !isNull;\n        if(isNull){\n            this.GetGameObject('chick').active = false;\n            this.GetGameObject(\"lbl_lv\").active = false;\n            this.GetGameObject(\"flower1\").active = false;\n            return;\n        }\n        if (!isNull)\n        {\n            this.GetGameObject(\"lbl_lv\").getComponent(cc.Label).string = \"lv.\" + this.datacopy.lv;\n            if(this.droptype == 0)\n            {\n                this.GetGameObject('chick').active = true;\n                this.GetGameObject(\"lbl_lv\").active = true;\n                this.GetGameObject(\"flower1\").active = false;\n                await this.produceChick();\n            }\n            else\n            {\n                this.GetGameObject('chick').active = false;\n                this.GetGameObject(\"lbl_lv\").active = false;\n                this.GetGameObject(\"flower1\").active = true;\n                this.showPot('spine:pot1');\n            }\n        }\n    }\n    \n    private async showPot(path:string){\n        this.curplayani =  \"pot1_idle\";\n        let potAni = this.GetDragonAmature('flower1');\n        potAni.playAnimation('fall',1);\n        this.node.runAction(cc.sequence(cc.delayTime(0.8),cc.callFunc(()=>{\n            potAni.playAnimation('idle',0);\n        })));\n    }\n\n    private async produceChick(){\n        let info = Config_chick[Math.min(this.datacopy.lv - 1,59)];\n        this.cd = Number(info[1]);\n        let nowani = this.datacopy.lv + '_idleL';\n        if(this.curplayani != nowani)\n        {\n            this.curplayani = nowani;\n            let sfid = Math.min(this.datacopy.lv,60);\n            let skpath = `spine:flower${sfid}_ske`;\n            let atlaspath = `spine:flower${sfid}_tex`;\n            let chick = this.GetDragonAmature('chick');\n            chick.dragonAsset = await Utils.loadRes(skpath,dragonBones.DragonBonesAsset) as dragonBones.DragonBonesAsset;\n            chick.dragonAtlasAsset = await Utils.loadRes(atlaspath,dragonBones.DragonBonesAtlasAsset) as dragonBones.DragonBonesAtlasAsset;\n            chick.armatureName = 'Armature';\n            chick.playAnimation('idleL',0);\n        }\n    }\n\n    private animComplete(evt:cc.Event){\n        if(evt.type == dragonBones.EventObject.COMPLETE){\n            let chick = this.GetDragonAmature('chick');\n            if(chick.animationName == 'atkR'){\n                chick.playAnimation('idleR',0);\n                this.curplayani = 'idleR';\n            }\n            else if(chick.animationName == 'atkL'){\n                chick.playAnimation('idleL',0);\n                this.curplayani = 'idleL';\n            }\n        }\n    }\n\n    private getTarget()\n    {\n        let enemylist = HallScene.Instance.enemylist;\n        let target = null;\n        let mindis = 600;\n        for(var i = 0;i<enemylist.length;++i)\n        {\n            if(enemylist[i].x< -cc.winSize.width/2)continue;\n            let dis = enemylist[i].position.sub(this.node.position).mag();\n            if(dis < mindis)\n            {\n                target = enemylist[i];\n                mindis = dis;\n            }\n        }\n\n        return target;\n    }\n    private cd = 0;\n    \n    private lastfire = 0;\n    update(dt)\n    {\n        if(dt > 1) dt = 1;\n        let chick = this.GetDragonAmature('chick');\n        if(this.datacopy && this.droptype == 0 && ChickData.user.double_att_time > Utils.getServerTime())\n        {\n            if(chick) chick.timeScale = 1.5;\n            this.GetGameObject(\"kb\").active = true;\n        }\n        else\n        {\n            if(chick) chick.timeScale = 1;\n            this.GetGameObject(\"kb\").active = false;\n        }\n        if(this.droptype != 0)\n        {\n            if(Utils.getServerTime() > this.droptype0endtime)\n            {\n                this.droptype = 0;\n                this.updateItem();\n            }\n        }\n        if(this.bDrag) return;\n        if(!this.datacopy) return;\n        if(this.droptype != 0) return;\n        this.lastfire += dt;\n        if(this.lastfire >= this.cd / ((ChickData.user.double_att_time > Utils.getServerTime()) ? 2 : 1))\n        {\n            this.lastfire = 0;\n            let target = this.getTarget();\n            if(target)\n            {\n                this.node.runAction(cc.sequence(cc.delayTime(0.5),cc.callFunc(()=>{\n                    if(this.bDrag) return;\n                    if(!this.datacopy) return;\n                    let b = cc.instantiate(this.bullet_pre);\n                    b.position = this.node.position.add(target.x > this.node.x ? cc.v3(30,35,0):cc.v3(-30,35,0));\n                    b.parent = HallScene.Instance.GetGameObject(\"node_bullet\");\n                    b.getComponent(Bullet).setInfo(target,this.datacopy.lv);\n                    if(target.x > this.node.x)\n                    {\n                        chick.playAnimation('atkR',1);\n                        this.curplayani = \"atkR\";\n                    }\n                    else\n                    {\n                        chick.playAnimation('atkL',1);\n                        this.curplayani = \"atkL\";\n                    }\n                })))\n            }\n        }\n    }\n}\n"]}