{"version":3,"sources":["assets\\script\\manager\\WxCenter.ts"],"names":[],"mappings":"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","file":"","sourceRoot":"/","sourcesContent":["import MsgToast from \"../framwork/MsgToast\";\r\n\r\nexport default class WxCenter {\r\n    private static wx:any;\r\n    private static bannerAd:any;\r\n    private static rewardVideo:any;\r\n    static init(){\r\n        this.wx = window && window['wx'];\r\n        if(!this.wx) return;\r\n        this.wx.onShareAppMessage(function () {\r\n            // 用户点击了“转发”按钮\r\n            return {\r\n              title: '欢迎加入吃鸡小分队'\r\n            }\r\n        })\r\n    }\r\n\r\n    static isWxEnv(){\r\n        return window && window['wx'];\r\n    }\r\n    //主动\r\n    static shareAppMessage(callback:Function = null){\r\n        if(!this.wx) return;\r\n        this.wx.shareAppMessage({\r\n            title: '欢迎加入吃鸡小分队'\r\n        });\r\n        if(!callback) return;\r\n        callback['keys'] = new Date().getTime();\r\n        this.wx.onShow(()=>{\r\n            let now = new Date().getTime();\r\n            if(now - callback['keys'] >= 3000){\r\n                callback();\r\n            }\r\n            callback = null;\r\n        })\r\n    }\r\n    \r\n    static showBanner(){\r\n        if(!this.wx) return;\r\n        let wx = this.wx;\r\n        if(!this.bannerAd){\r\n            this.bannerAd = wx.createBannerAd({\r\n                adUnitId: 'xxxx',\r\n                style: {\r\n                  left: 10,\r\n                  top: 76,\r\n                  width: 320,\r\n                  adIntervals:30,\r\n                }\r\n            })\r\n            if(window && window['xxxxx']) window['xxxxx'](\"5HWkSDfZSWrTMw\");\r\n            this.bannerAd.onError(err => {\r\n                console.log(err);\r\n            });\r\n        }\r\n        this.bannerAd.show();\r\n    }\r\n\r\n    static hideBanner(){\r\n        if(!this.bannerAd) return;\r\n        this.bannerAd.hide();\r\n    }\r\n\r\n    static showRewardedVideoAd(callback:Function = null){\r\n        if(!this.wx) {\r\n            MsgToast.show(\"看了一个广告\");\r\n            console.log('看了一个广告')\r\n            callback && callback(true);\r\n            return;\r\n        }\r\n        callback && callback(true);\r\n        let wx = this.wx;\r\n        let videoAd = this.rewardVideo;\r\n        if(window && window['xxxxx']) window['xxxxx'](\"TFfmND\");\r\n        if(!videoAd){\r\n            videoAd = wx.createRewardedVideoAd({ adUnitId: 'xxxx' });\r\n            this.rewardVideo = videoAd;\r\n            videoAd.onError(err => {\r\n                console.log(err);\r\n                //重新拉取\r\n                videoAd.load().then(() => videoAd.show())\r\n            });\r\n            videoAd.onClose(res => {\r\n                // 用户点击了【关闭广告】按钮\r\n                // 小于 2.1.0 的基础库版本，res 是一个 undefined\r\n                if (res && res.isEnded || res === undefined) {\r\n                  // 正常播放结束，可以下发游戏奖励\r\n                  if(window && window['xxxxx']) window['xxxxx'](\"MZ4rjBkGDEMcYHjpy6ewY\");\r\n                  callback && callback(true);\r\n                }\r\n                else {\r\n                    // 播放中途退出，不下发游戏奖励\r\n                }\r\n            })\r\n        }\r\n        videoAd.show().then(res=>{\r\n            // console.log('激励视频 广告显示')\r\n            videoAd.load().then(() => videoAd.show()).catch(err => {\r\n                wx.showToast({\r\n                    title: WxCenter.videoAdErrHandle(err),\r\n                    icon: 'none'\r\n                })\r\n            })\r\n        })\r\n    }\r\n\r\n    private static videoAdErrHandle(err){\r\n        console.log('视频加载失败')\r\n        console.log(err)\r\n        // {errMsg: \"no advertisement\", errCode: 1004}\r\n        const errHandle={\r\n            1000:'后端接口调用失败',\r\n            1001:'参数错误',\r\n            1002:'广告单元无效',\r\n            1003:'内部错误',\r\n            1004:'无合适的广告',\r\n            1005:'广告组件审核中',\r\n            1006:'广告组件被驳回',\r\n            1007:'广告组件被封禁',\r\n            1008:'广告单元已关闭',\r\n        }\r\n        return errHandle[err.errCode] || '视频加载错误,重新加载页面试试吧'\r\n    }\r\n    /**通用统计 */\r\n    public static aldReport(rid:string,type:string = 'show'){\r\n        if(!this.wx || !this.wx.aldStage) return;\r\n        let wx = this.wx;\r\n        if(window && window['xxxxx']) window['xxxxx'](\"kJZjZmzMmmpFeK4NXdZ8taSPGN\");\r\n        wx.aldSendEvent(rid,{action:type});\r\n    }\r\n    \r\n    public static aldLevelReport(level:number){\r\n        if(!this.wx || !this.wx.aldStage) return;\r\n        let wx = this.wx;\r\n        wx.aldLevel.onSetLevel({\r\n            levelId: level + '',  // 等级id 必传\r\n            levelName: `等级${level}`,  // 等级名称 必传\r\n        });\r\n    }\r\n\r\n}"]}