{"version":3,"sources":["assets\\script\\utils\\AudioMgr.ts"],"names":[],"mappings":"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","file":"","sourceRoot":"/","sourcesContent":["import Singleton from \"../manager/Singleton\";\r\nimport Utils from './Utils';\r\nexport default class AudioMgr extends Singleton {\r\n\r\n    public bgmVolume: number = 1;\r\n    public sfxVolume: number = 1;\r\n\r\n    bgmAudioID: number = -1;\r\n    audioId: number = -1;\r\n\r\n    loadSounds() {\r\n        var t = cc.sys.localStorage.getItem(\"bgmVolume\");\r\n        var t1 = cc.sys.localStorage.getItem(\"sfxVolume\");\r\n\r\n        this.bgmVolume = t == 0 ? Number(t) : 1;\r\n        this.sfxVolume = t1 == 0 ? Number(t1) : 1;\r\n        console.log(\"loadSounds\", this.bgmVolume, this.sfxVolume)\r\n\r\n        cc.log(this.bgmVolume, this.sfxVolume)\r\n        cc.loader.loadResDir(\"sounds\",()=>{\r\n            this.playBGM(\"BGM1\");\r\n        });\r\n    }\r\n\r\n    // getUrl(url: string): cc.AudioClip {\r\n    //     return cc.loader.getRes(\"sounds/\" + url);\r\n    // }\r\n\r\n    private bgm_url: string = \"BGM1\"\r\n    async playBGM(url: string) {\r\n        this.bgm_url = url;\r\n        var audioUrl = await Utils.loadRes(\"sounds:\"+url,cc.AudioClip) as cc.AudioClip;// this.getUrl(url);\r\n        if (this.bgmAudioID >= 0) {\r\n            cc.audioEngine.stop(this.bgmAudioID);\r\n        }\r\n        if (this.bgmVolume > 0) {\r\n            this.bgmAudioID = cc.audioEngine.play(audioUrl, true, this.bgmVolume);\r\n        }\r\n    }\r\n\r\n    stopSFX(audioId: number) {\r\n        var ok = cc.audioEngine.stop(audioId);\r\n        return ok;\r\n    }\r\n\r\n    private lastplaysfxtime = {};\r\n    private sfxcd = {\r\n        \"huangshulang\":1500,\r\n        \"huli\":1500,\r\n        \"hit\":300,\r\n        \"merge_success\":100,\r\n        \"skill_freeze\":300,\r\n        \"skill_slow\":300\r\n    }\r\n\r\n    async playSFX(url: string) {\r\n        // if (GameManager.Instance.fps < 20) return;\r\n\r\n        if (!this.lastplaysfxtime[url])\r\n            this.lastplaysfxtime[url] = 0;\r\n        let cd = this.sfxcd[url] || 0;\r\n        if (new Date().getTime() - this.lastplaysfxtime[url] < cd) {\r\n            return;\r\n        }\r\n        this.lastplaysfxtime[url] = new Date().getTime();\r\n\r\n        var audioUrl = await Utils.loadRes(\"sounds:\"+url,cc.AudioClip) as cc.AudioClip; ;//this.getUrl(url);\r\n        if (audioUrl&&this.sfxVolume > 0) {\r\n            this.audioId = cc.audioEngine.play(audioUrl, false, this.sfxVolume);\r\n            return this.audioId;\r\n        }\r\n    }\r\n\r\n    pauseBGM() {\r\n        if (this.bgmAudioID >= 0) {\r\n            cc.audioEngine.pause(this.bgmAudioID);\r\n            // cc.log(\"暂停bgm\")\r\n        }\r\n    }\r\n\r\n    resumBGM() {\r\n        if (this.bgmAudioID >= 0) {\r\n            cc.audioEngine.resume(this.bgmAudioID);\r\n            // cc.log(\"恢复bgm\")\r\n        }\r\n    }\r\n\r\n    setBGMVolume(v: number, force: boolean = false) {\r\n        if (this.bgmVolume != v || force) {\r\n            cc.sys.localStorage.setItem(\"bgmVolume\", v);\r\n            this.bgmVolume = v;\r\n            cc.audioEngine.setVolume(this.bgmAudioID, v);\r\n        }\r\n        if (this.bgmAudioID >= 0) {\r\n            if (v > 0) {\r\n                cc.audioEngine.resume(this.bgmAudioID);\r\n            } else {\r\n                cc.audioEngine.pause(this.bgmAudioID);\r\n            }\r\n        } else {\r\n            this.playBGM(this.bgm_url);\r\n        }\r\n    }\r\n\r\n    setSFXVolume(v: number, force: boolean = false) {\r\n        if (this.sfxVolume != v || force) {\r\n            cc.sys.localStorage.setItem(\"sfxVolume\", v);\r\n            this.sfxVolume = v;\r\n            //设置音效大小会同时设置背景音乐的声音，不设置音效大小，本地音效依然可以受控使用，暂未找到原因\r\n            // cc.audioEngine.setEffectsVolume(v);\r\n        }\r\n    }\r\n}"]}