{"version":3,"sources":["assets\\script\\game\\prefab\\AdLayer.ts"],"names":[],"mappings":"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","file":"","sourceRoot":"/","sourcesContent":["import BaseUI from \"../../framwork/BaseUI\";\r\nimport MsgHints from \"../../framwork/MsgHints\";\r\nimport AdCenter from \"../../manager/AdCenter\";\r\nimport Data from \"../../manager/Data\";\r\nimport AudioMgr from \"../../utils/AudioMgr\";\r\nimport Utils from \"../../utils/Utils\";\r\n\r\nconst { ccclass, property } = cc._decorator;\r\n\r\n\r\nenum EADLAYER {\r\n    DOUBLE_ATT,\r\n    DOUBLE_INCOME,\r\n    AUTO_COM,\r\n    DROP_PLANT\r\n}\r\n\r\nconst add_time_auto_com = 2;\r\nconst add_time_double_income = 10;\r\nconst add_time_drop_plant = 10;\r\nconst add_time_double_att = 1;\r\n\r\nconst auto_com_gem = 4;\r\nconst double_income_gem = 4;\r\nconst double_att_gem = 4;\r\nconst double_drop_plant_gem = 4;\r\n\r\nexport const max_auto_com = 10;\r\nexport const max_auto_double_income = 60;\r\nexport const max_auto_double_att = 6;\r\nexport const max_drop_plant = 60;\r\n\r\n@ccclass\r\nexport default class AdLayer extends BaseUI {\r\n\r\n\r\n    start()\r\n    {\r\n        AdCenter.Instance().showGridAd();\r\n    }\r\n\r\n    onDestroy()\r\n    {\r\n        AdCenter.Instance().hideGridAd();\r\n        super.onDestroy();\r\n    }\r\n\r\n    update(dt)\r\n    {\r\n        if(dt > 1) dt = 1;\r\n        let {end_time,max} = this.getEndAndMaxTime();\r\n        if(end_time > Utils.getServerTime())\r\n        {\r\n            let nLeft = end_time - Utils.getServerTime();\r\n            // this.SetProgressBar(\"New ProgressBar\",(nLeft/1000/60)/max);\r\n            this.SetText(\"lbl_time\",Utils.getTimeStrByS(nLeft/1000));\r\n        }\r\n        else\r\n        {\r\n            // this.SetProgressBar(\"New ProgressBar\",0);\r\n            this.SetText(\"lbl_time\",\"\");\r\n        }\r\n    }\r\n\r\n    private getEndAndMaxTime(){\r\n        let end_time = 0;\r\n        let max = 0;\r\n        if (this.type == EADLAYER.AUTO_COM) {\r\n            end_time = Data.user.auto_com_time;\r\n            max = max_auto_com;\r\n        }\r\n        else if (this.type == EADLAYER.DOUBLE_ATT) {\r\n            end_time = Data.user.double_att_time;\r\n            max = max_auto_double_att;\r\n        }\r\n        else if (this.type == EADLAYER.DOUBLE_INCOME) {\r\n            end_time = Data.user.double_income_time;\r\n            max = max_auto_double_income;\r\n        }\r\n        else if(this.type == EADLAYER.DROP_PLANT)\r\n        {\r\n            end_time = Data.user.drop_plant_time;\r\n            max = max_drop_plant;\r\n        }\r\n        return {end_time,max}\r\n    }\r\n\r\n    private type: EADLAYER;\r\n    setType(e: EADLAYER) {\r\n        this.type = e;\r\n        this.GetGameObject(\"icon_fast\").active = e == EADLAYER.DROP_PLANT;\r\n        this.GetGameObject(\"icon_auto_merge\").active = e == EADLAYER.AUTO_COM;\r\n        this.GetGameObject(\"icon_income\").active = e == EADLAYER.DOUBLE_INCOME;\r\n        this.GetGameObject(\"icon_angre\").active = e == EADLAYER.DOUBLE_ATT;\r\n\r\n        if (this.type == EADLAYER.AUTO_COM) {\r\n            this.SetText(\"lbl_effect\", \"+\" + add_time_auto_com + \"分钟\");\r\n        }\r\n        else if (this.type == EADLAYER.DOUBLE_ATT) {\r\n\r\n            this.SetText(\"lbl_effect\", \"+\" + add_time_double_att + \"分钟\");\r\n        }\r\n        else if (this.type == EADLAYER.DOUBLE_INCOME) {\r\n            // this.SetText(\"lbl_effect\", \"增加\" + add_time_double_income + \"分钟双倍收益时间\");\r\n            this.SetText(\"lbl_effect\", \"+\" + add_time_double_income + \"分钟\");\r\n        }\r\n        else if(this.type == EADLAYER.DROP_PLANT)\r\n        {\r\n            this.SetText(\"lbl_effect\", \"+\" + add_time_drop_plant + \"分钟\");\r\n        }\r\n        let {end_time,max} = this.getEndAndMaxTime();\r\n        this.GetGameObject('btn_normal').active = end_time <= Utils.getServerTime()\r\n    }\r\n\r\n    private addvalue(gem:number = 1)\r\n    {\r\n        let isUse = false;\r\n        if (this.type == EADLAYER.AUTO_COM) {\r\n            if (Data.user.auto_com_time - Utils.getServerTime() > (max_auto_com - add_time_auto_com) * 60 * 1000) {\r\n                MsgHints.show(\"最大累积时间\" + max_auto_com + \"分钟\");\r\n                return;\r\n            }\r\n            if (Data.user.auto_com_time < Utils.getServerTime())\r\n                Data.user.auto_com_time = Utils.getServerTime();\r\n            Data.user.auto_com_time += add_time_auto_com * 60 * 1000 * gem;\r\n            isUse = true;\r\n        }\r\n        else if (this.type == EADLAYER.DOUBLE_ATT) {\r\n            if (Data.user.double_att_time - Utils.getServerTime() > (max_auto_double_att - add_time_double_att) * 60 * 1000) {\r\n                MsgHints.show(\"最大累积时间\" + max_auto_double_att + \"分钟\");\r\n                return;\r\n            }\r\n            if (Data.user.double_att_time < Utils.getServerTime())\r\n                Data.user.double_att_time = Utils.getServerTime();\r\n            Data.user.double_att_time += add_time_double_att * 60 * 1000 * gem;\r\n            isUse = true;\r\n        }\r\n        else if (this.type == EADLAYER.DOUBLE_INCOME) {\r\n            if (Data.user.double_income_time - Utils.getServerTime() > (max_auto_double_income - add_time_double_income) * 60 * 1000) {\r\n                MsgHints.show(\"最大累积时间\" + max_auto_double_income + \"分钟\");\r\n                return;\r\n            }\r\n            if (Data.user.double_income_time < Utils.getServerTime())\r\n                Data.user.double_income_time = Utils.getServerTime();\r\n            Data.user.double_income_time += add_time_double_income * 60 * 1000 * gem;\r\n            isUse = true;\r\n        }\r\n        else if (this.type == EADLAYER.DROP_PLANT) {\r\n            if (Data.user.drop_plant_time - Utils.getServerTime() > (max_drop_plant - add_time_drop_plant) * 60 * 1000) {\r\n                MsgHints.show(\"最大累积时间\" + max_drop_plant + \"分钟\");\r\n                return;\r\n            }\r\n            if (Data.user.drop_plant_time < Utils.getServerTime())\r\n                Data.user.drop_plant_time = Utils.getServerTime();\r\n            Data.user.drop_plant_time += add_time_drop_plant * 60 * 1000 * gem;\r\n            isUse = true;\r\n        }\r\n        Data.save();\r\n        if(isUse) {\r\n            this.closeUI();\r\n            MsgHints.show('使用成功');\r\n        }\r\n    }\r\n\r\n    onBtnClicked(event, customEventData) {\r\n        var btnName = event.target.name;\r\n        AudioMgr.Instance().playSFX(\"click\");\r\n        switch (btnName) {\r\n            case \"btn_close\":\r\n                this.closeUI();\r\n                break;\r\n            case \"btn_ad\":\r\n                AdCenter.Instance().play((b)=>{\r\n                    if(b) this.addvalue(2);\r\n                });\r\n                break;\r\n            case \"btn_normal\":\r\n                this.addvalue(1);\r\n                this.GetGameObject('btn_normal').active = false;\r\n                break;\r\n            // case \"btn_gem\":\r\n            //     let gem = 0;\r\n            //     if (this.type == EADLAYER.AUTO_COM) {\r\n            //         gem = auto_com_gem\r\n            //     }\r\n            //     else if (this.type == EADLAYER.DOUBLE_ATT) {\r\n            //         gem = double_att_gem\r\n            //     }\r\n            //     else if (this.type == EADLAYER.DOUBLE_INCOME) {\r\n            //         gem = double_income_gem                   \r\n            //     }\r\n            //     else if (this.type == EADLAYER.DROP_PLANT) {\r\n            //         gem = double_drop_plant_gem                 \r\n            //     }\r\n            //     this.addvalue(gem);\r\n            //     break;\r\n            }\r\n    }\r\n}\r\n\r\n\r\n\r\nexport { EADLAYER }\r\n"]}