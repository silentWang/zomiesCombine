{"version":3,"sources":["assets\\script\\manager\\AdCenter.ts"],"names":[],"mappings":"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","file":"","sourceRoot":"/","sourcesContent":["import Singleton from \"./Singleton\";\r\nimport MsgToast from \"../framwork/MsgToast\";\r\n\r\nimport Utils from '../utils/Utils';\r\nimport AudioMgr from \"../utils/AudioMgr\";\r\n\r\nconst dyTT = window[\"tt\"];\r\n\r\nconst { ccclass, property } = cc._decorator;\r\nexport default class AdCenter extends Singleton {\r\n    videoAdID = null;\r\n\r\n    bannerAdID = null;\r\n\r\n    bannerAd = null;\r\n\r\n    interstitialAd = null\r\n\r\n    constructor() {\r\n        super();\r\n\r\n        if (dyTT && dyTT.createRewardedVideoAd) {\r\n            this.videoAdID = dyTT.createRewardedVideoAd({\r\n                adUnitId: '73ejb9hf3j84rs5p9b'\r\n            });\r\n\r\n            this.videoAdID.onError((res) => {\r\n                MsgToast.show('视频加载失败');\r\n            });\r\n\r\n            this.videoAdID.onLoad((res) => {\r\n                console.log('------videoAdID---广告加载---',res);\r\n            })\r\n\r\n            this.videoAdID.onClose(res => {\r\n                if (res && res.isEnded || res === undefined) {\r\n                    cc.log(\"正常播放结束，可以下发游戏奖励\")\r\n                    this.callBack(true);\r\n                }\r\n                else {\r\n                    cc.log(\"播放中途退出，不下发游戏奖励\")\r\n                    this.callBack(false);\r\n                }\r\n                AudioMgr.Instance().resumMusic()\r\n            })\r\n\r\n            this.videoAdID.load()\r\n\r\n            // if (dyTT.createInterstitialAd) {\r\n            //     this.interstitialAd = dyTT.createInterstitialAd({\r\n            //         adUnitId: 'dj4bajb3m18ue2079v'\r\n            //     })\r\n            //     this.interstitialAd.load().catch((err)=>{\r\n            //         console.log('interstitialAd--error--',err)\r\n            //     })\r\n            // }\r\n\r\n            // let { screenWidth, screenHeight } = dyTT.getSystemInfoSync()\r\n            // this.bannerAd = tt.createBannerAd({\r\n            //     adUnitId: '3a3ld4b071g57lnlji',\r\n            //     style: { width: screenWidth,\r\n            //         top:screenHeight - 150 }\r\n            // })\r\n        }\r\n    }\r\n\r\n    private callBack: Function;\r\n    private _lastPlayTime: number = 0;\r\n    public play(callback: Function, type:number) {\r\n        if (Utils.getServerTime() - this._lastPlayTime < 1000) {\r\n            console.log(\"点击过于频繁\")\r\n            return;\r\n        }\r\n        AudioMgr.Instance().pauseMusic()\r\n        this._lastPlayTime = Utils.getServerTime();\r\n        this.callBack = callback;\r\n        if(dyTT){\r\n            this.playVideo(type);\r\n        }\r\n        else{\r\n            callback && callback(1)\r\n            AudioMgr.Instance().resumMusic()\r\n        }\r\n        \r\n    }\r\n\r\n    private playVideo(type:number){\r\n        if ( this.videoAdID) {\r\n            let video = this.videoAdID\r\n            dyTT.showLoading({title:'加载中'})\r\n            setTimeout(()=>{\r\n                dyTT.hideLoading()\r\n            },3000)\r\n            \r\n            video.show().catch(() => {\r\n                video.load().then(() => video.show())\r\n                .catch(err => {\r\n                    cc.log('激励视频 广告显示失败');\r\n                    this.callBack(false);\r\n                    AudioMgr.Instance().resumMusic()\r\n                    MsgToast.show('视频加载失败');\r\n                    dyTT.hideLoading()\r\n                })\r\n            })\r\n        }\r\n        else {\r\n            this.callBack(true);\r\n            AudioMgr.Instance().resumMusic()\r\n        }\r\n    }\r\n    \r\n    public showGridAd() \r\n    {\r\n        if (this.bannerAd)\r\n            this.bannerAd.show()\r\n    }\r\n\r\n    public hideGridAd() {\r\n        if (this.bannerAd)\r\n            this.bannerAd.hide()\r\n    }\r\n\r\n    public showInterstitialAd(){\r\n        // let interAd = this.interstitialAd\r\n        // if (interAd) {\r\n        //     interAd.show().catch((err) => {\r\n        //         interAd.load().then(()=>{\r\n        //             interAd.show()\r\n        //         }).catch((err)=>{\r\n        //             console.log('interstitialAd--error--',err)\r\n        //         })\r\n        //     })\r\n        // }\r\n    }\r\n\r\n}"]}