{"version":3,"sources":["assets\\script\\game\\prefab\\ShopItem.ts"],"names":[],"mappings":"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","file":"","sourceRoot":"/","sourcesContent":["import BaseUI from \"../../framwork/BaseUI\";\r\nimport ListItem from \"../../framwork/ListItem\";\r\nimport MsgToast from \"../../framwork/MsgToast\";\r\nimport AdCenter from \"../../manager/AdCenter\";\r\nimport ChickData from \"../../manager/ChickData\";\r\nimport AudioMgr from \"../../utils/AudioMgr\";\r\nimport Utils from \"../../utils/Utils\";\r\nimport GameConst from \"../GameConst\";\r\nimport HallScene from \"../HallScene\";\r\n\r\n\r\nconst {ccclass, property} = cc._decorator;\r\n\r\nenum GunBuyType {\r\n    CAN_BUY = 1,\r\n    CAN_AD_BUY= 2,\r\n    ONLY_CHECK= 4,\r\n    // CNNOT_SEE= 8,\r\n    GEM_BUY= 16,\r\n}\r\n\r\n\r\n@ccclass\r\nexport default class ShopItem extends BaseUI {\r\n\r\n    //观看视频免费获得的枪械等级\r\n    private ShowBuyAd(id:number):boolean\r\n    {\r\n        var gunlv = ChickData.user.getLvlMax();\r\n        if(gunlv < 8)return false;\r\n        return gunlv - 4 == id;\r\n    }\r\n\r\n    //不可指定购买只可查看的区间\r\n    private OnlyForCheck(id:number):boolean\r\n    {\r\n        var gunlv = ChickData.user.getLvlMax();\r\n        if(gunlv - 2 <= id && id <= gunlv )\r\n        {\r\n            return true;\r\n        }\r\n        return false;\r\n    }\r\n\r\n    private BuyDiamond(id:number):boolean\r\n    {\r\n        var gunlv = ChickData.user.getLvlMax();\r\n        return gunlv - 1 == id;\r\n    }\r\n\r\n    private getBuyCoinType(gun)\r\n    {\r\n        var gunlv = ChickData.user.getLvlMax()\r\n        var type:number = 0;\r\n        if(gun[0] <= gunlv - 2)\r\n        {\r\n            type |= GunBuyType.CAN_BUY;\r\n        }\r\n        if(this.ShowBuyAd(gun[0]))\r\n        {\r\n            type |= GunBuyType.CAN_AD_BUY;\r\n        }\r\n        if(this.BuyDiamond(gun[0]))\r\n        {\r\n            type |= GunBuyType.GEM_BUY;\r\n        }\r\n        if(this.OnlyForCheck(gun[0]))\r\n        {\r\n            type |= GunBuyType.ONLY_CHECK;\r\n        }\r\n\r\n        return type;\r\n    }\r\n\r\n    private cost_coin:number = 0;\r\n    gun:any = null;\r\n    async setShopItemData(gun:any)\r\n    {   \r\n        // [\"level\", \"cd\", \"power\", \"skill\", \"offline\", \"price\", \"gem\", \"prefab\", \"shootPos\", \"steakColor\", \"head\"]\r\n        let node = null;\r\n        let bhide = false;\r\n        let buytype = this.getBuyCoinType(gun);\r\n        this.gun = gun;\r\n\r\n        this.GetGameObject(\"show\").active = false;\r\n        this.GetGameObject(\"hide\").active = false;\r\n\r\n        this.GetGameObject(\"btn_yellow\").active = false;\r\n        this.GetGameObject(\"btn_free\").active = false;\r\n        this.GetGameObject(\"btn_gray\").active = false;\r\n        \r\n        if((buytype & GunBuyType.GEM_BUY) != 0 && gun[6]>0)\r\n        {\r\n            this.GetGameObject(\"show\").active = true;\r\n            node = this.GetGameObject(\"show\");\r\n        }\r\n        else if((buytype & GunBuyType.CAN_AD_BUY) != 0)\r\n        {\r\n            this.GetGameObject(\"show\").active = true;\r\n            this.GetGameObject(\"btn_free\").active = true;\r\n            node = this.GetGameObject(\"show\");\r\n        }\r\n        else if((buytype & GunBuyType.CAN_BUY) != 0)\r\n        {\r\n            this.GetGameObject(\"show\").active = true;\r\n            this.GetGameObject(\"btn_yellow\").active = true;\r\n            node = this.GetGameObject(\"show\");\r\n        }\r\n        else\r\n        {\r\n            if((buytype & GunBuyType.ONLY_CHECK) != 0)\r\n            {\r\n                this.GetGameObject(\"show\").active = true;\r\n                this.GetGameObject(\"btn_gray\").active = true;\r\n                node = this.GetGameObject(\"show\");\r\n            }\r\n            else\r\n            {\r\n                this.GetGameObject(\"hide\").active = true;\r\n                node = this.GetGameObject(\"hide\");\r\n                bhide = true;\r\n            }\r\n        }\r\n\r\n        this._findInChildren(node,\"lbl_lv\").getComponent(cc.Label).string = \"\"+gun[0];\r\n        this._findInChildren(node,\"New Label\").getComponent(cc.Label).string = \"到\"+(gun[0]+2)+'级解锁';\r\n\r\n        let skill = gun[3].split(\"|\");\r\n        let skilltype = skill[0];\r\n        let value = skill[1];\r\n\r\n        let str = \"\";\r\n\r\n        if(bhide) value = \"?\"\r\n        if(skilltype == 1)\r\n        {\r\n            str =\"技能:\" + value+\"%的几率触发减速目标1秒\";\r\n        }\r\n        else if(skilltype == 2){\r\n            str =\"技能:\" + value+\"%几率对目标造成双倍伤害\";\r\n        }\r\n        else if(skilltype == 3){\r\n            str =\"技能:\" + value+\"%几率冰冻目标1秒\";\r\n        }\r\n\r\n        this._findInChildren(node,\"lbl_name\").getComponent(cc.Label).string = bhide?'未知萌鸡':gun[7];\r\n        this._findInChildren(node,\"lbl_desc\").getComponent(cc.Label).string = bhide?'技能:未知':str;\r\n        this._findInChildren(node,\"lbl_cd\").getComponent(cc.Label).string =bhide?\"?\": gun[1]+\"\";\r\n        this._findInChildren(node,\"lbl_power\").getComponent(cc.Label).string = bhide?\"?\":Utils.formatNumber(gun[2])+\"\";\r\n        \r\n        if(!bhide){\r\n            let skpath = `spine:flower${gun[0]}_ske`;\r\n            let atlaspath = `spine:flower${gun[0]}_tex`;\r\n            let chick = this.GetDragonAmature('shopChick');\r\n            chick.dragonAsset = await Utils.loadRes(skpath,dragonBones.DragonBonesAsset) as dragonBones.DragonBonesAsset;\r\n            chick.dragonAtlasAsset = await Utils.loadRes(atlaspath,dragonBones.DragonBonesAtlasAsset) as dragonBones.DragonBonesAtlasAsset;\r\n            chick.armatureName = 'Armature';\r\n            chick.playAnimation('idleL',0);\r\n        }\r\n        \r\n        this.cost_coin = ChickData.user.buyChickPrice(gun[0])\r\n        this.SetText(\"lbl_buy_coin\",Utils.formatNumber( this.cost_coin));\r\n        this.GetButton(\"btn_yellow\").interactable = ChickData.user.coin >= this.cost_coin;\r\n    }\r\n    \r\n    onUIClicked(event, customEventData) {\r\n        super.onUIClicked(event,customEventData);\r\n        var btnName = event.target.name;\r\n        \r\n        AudioMgr.Instance().playMX(\"click\");\r\n        switch (btnName) {\r\n            case \"btn_free\":\r\n                AdCenter.Instance().play((b)=>{\r\n                    if(b)\r\n                    {\r\n                        if(HallScene.Instance.buyChick(this.gun[0],2))\r\n                        {\r\n                           MsgToast.show(\"购买成功\");\r\n                           this.dispatch(GameConst.BUY_CHICK,this.gun,this.node.getComponent(ListItem).listId);\r\n                        }\r\n                    }\r\n                },1)\r\n                break\r\n            case \"btn_yellow\":\r\n                if(ChickData.user.coin < this.cost_coin )\r\n                {\r\n                    MsgToast.show(\"金币不足\")\r\n                    return;\r\n                }\r\n                if(HallScene.Instance.buyChick(this.gun[0],0))\r\n                {\r\n                    MsgToast.show(\"购买成功\");\r\n                    this.dispatch(GameConst.BUY_CHICK,this.gun,this.node.getComponent(ListItem).listId);\r\n                }\r\n                break;\r\n        }\r\n    }\r\n}\r\n"]}